# Importamos m√≥dulos necesarios
import json  # Para leer y escribir archivos en formato JSON
import os    # Para comprobar si el archivo existe en el sistema

# Nombre del archivo donde se guardar√°n las tareas
ARCHIVO = "tareas.json"

# --- FUNCIONES DE ARCHIVO ---

# Verifica si el archivo existe, y si no, lo crea con una lista vac√≠a
def inicializar_archivo():
    if not os.path.exists(ARCHIVO):
        with open(ARCHIVO, "w", encoding="utf-8") as f:
            json.dump([], f)  # Guardamos una lista vac√≠a en formato JSON
        print("üìÅ Archivo tareas.json creado.")

# Carga las tareas desde el archivo JSON
def cargar_tareas():
    if os.path.exists(ARCHIVO):
        with open(ARCHIVO, "r", encoding="utf-8") as f:
            contenido = f.read().strip()  # Leemos y eliminamos espacios vac√≠os
            if not contenido:
                print("üì≠ El archivo est√° vac√≠o. Se iniciar√° con una lista vac√≠a.")
                return []
            try:
                return json.loads(contenido)  # Convertimos el texto JSON en lista de tareas
            except json.JSONDecodeError as e:
                print(f"‚ö†Ô∏è Error de formato JSON: {e}")
                return []
    return []  # Si no existe el archivo, devolvemos lista vac√≠a

# Guarda la lista de tareas en el archivo JSON
def guardar_tareas(tareas):
    with open(ARCHIVO, "w", encoding="utf-8") as f:
        json.dump(tareas, f, indent=4, ensure_ascii=False)  # Guardamos con formato legible

# --- FUNCIONES DE GESTI√ìN DE TAREAS ---

# Muestra todas las tareas en consola
def mostrar_tareas(tareas):
    if not tareas:
        print("No hay tareas.")
        return
    # Recorremos cada tarea y la mostramos con su n√∫mero, descripci√≥n, fecha y prioridad
    for i, tarea in enumerate(tareas, 1):
        print(f"{i}. üìù {tarea.get('TAREA', 'Sin descripci√≥n')} | üìÖ {tarea.get('FECHA', 'Sin fecha')} | ‚ö° {tarea.get('PRIORIDAD', 'Sin prioridad')}")

# A√±ade una nueva tarea a la lista
def a√±adir_tarea(tareas):
    # Pedimos al usuario los datos de la tarea
    descripcion = input("Escribe la tarea: ")
    fecha = input("Fecha: ")
    prioridad = input("Prioridad (Alta/Media/Baja): ")
    # Creamos un diccionario con los datos
    nueva = {
        "ID": len(tareas) + 1,  # Asignamos un ID autom√°tico
        "TAREA": descripcion,
        "FECHA": fecha,
        "PRIORIDAD": prioridad
    }
    tareas.append(nueva)  # A√±adimos la tarea a la lista
    print("‚úÖ Tarea a√±adida correctamente.")

# Elimina una tarea seg√∫n el n√∫mero que el usuario indique
def eliminar_tarea(tareas):
    mostrar_tareas(tareas)  # Mostramos las tareas antes de eliminar
    try:
        num = int(input("N√∫mero de tarea a eliminar: "))  # Pedimos el n√∫mero
        if 1 <= num <= len(tareas):
            eliminada = tareas.pop(num - 1)  # Eliminamos la tarea correspondiente
            print(f"üóëÔ∏è Tarea eliminada: {eliminada.get('TAREA', 'Sin descripci√≥n')}")
        else:
            print("‚ùå N√∫mero inv√°lido.")
    except ValueError:
        print("‚ö†Ô∏è Entrada no v√°lida. Debes escribir un n√∫mero.")

# --- MEN√ö PRINCIPAL ---

# Muestra el men√∫ y gestiona las opciones del usuario
def menu():
    inicializar_archivo()  # Creamos el archivo si no existe
    tareas = cargar_tareas()  # Cargamos las tareas existentes
    while True:
        # Mostramos el men√∫ de opciones
        print("\n--- GESTOR DE TAREAS ---")
        print("1. Ver tareas")
        print("2. A√±adir tarea")
        print("3. Eliminar tarea")
        print("4. Salir")
        opcion = input("Elige una opci√≥n: ")

        # Ejecutamos la opci√≥n elegida
        if opcion == "1":
            mostrar_tareas(tareas)
        elif opcion == "2":
            a√±adir_tarea(tareas)
            guardar_tareas(tareas)  # Guardamos despu√©s de a√±adir
        elif opcion == "3":
            eliminar_tarea(tareas)
            guardar_tareas(tareas)  # Guardamos despu√©s de eliminar
        elif opcion == "4":
            print("üëã ¬°Hasta luego!")
            break  # Salimos del bucle
        else:
            print("‚ö†Ô∏è Opci√≥n inv√°lida. Intenta de nuevo.")

# Ejecutamos el men√∫ solo si el archivo se ejecuta directamente
if __name__ == "__main__":
    menu()
